---
import MainLayout from "../../layouts/MainLayout.astro";
import { getEpisodeIds, getEpisodeById, formatEpisodeId } from "../../data/episodes.js";

export async function getStaticPaths() {
  const episodes = getEpisodeIds();
  return episodes.map((episodeId) => ({ params: { episodeId } }));
}

const { episodeId } = Astro.params;
const episode = getEpisodeById(episodeId);

if (!episode) {
  throw new Error(`Episode not found: ${episodeId}`);
}

const episodeLabel = formatEpisodeId(episode.season, episode.episode);
const title = `${episode.episode_name} (${episodeLabel}) - The Office (US) Quotes | OfficeQuotes.xyz`;
const description = `Every quote from The Office (US) episode ${episode.episode_name} (Season ${episode.season}, Episode ${episode.episode}). Search and browse the full dialogue.`;
const canonical = `https://officequotes.xyz/episode/${episodeId}`;
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "TVEpisode",
  name: episode.episode_name,
  episodeNumber: episode.episode,
  seasonNumber: episode.season,
  partOfSeries: {
    "@type": "TVSeries",
    name: "The Office (US)"
  },
  url: canonical,
  description
};
---
<MainLayout title={title} description={description} canonical={canonical}>
  <script type="application/ld+json">
    {JSON.stringify(jsonLd)}
  </script>
  <header class="episode-header">
    <h1>{episode.episode_name}</h1>
    <span>Season {episode.season} - Episode {episode.episode} - {episodeId}</span>
  </header>

  <section class="quote-list">
    {episode.all_quotes.map((quote, index) => (
      <article class="quote-item" id={`quote-${episodeId}-${index}`}>
        <strong>{quote.character}</strong>: {quote.text}
      </article>
    ))}
  </section>
</MainLayout>
